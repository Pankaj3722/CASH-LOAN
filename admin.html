<!doctype html>
<html lang="hi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>LOAN PAY — Admin</title>
  <link rel="stylesheet" href="styles.css" />
  <style>
    .admin-header{display:flex;justify-content:space-between;align-items:center;gap:12px;margin-bottom:12px}
    .table{width:100%;border-collapse:collapse}
    .table th,.table td{padding:8px;border-bottom:1px solid #eee;text-align:left;font-size:13px}
    .small-btn{padding:6px 8px;border-radius:8px;border:1px solid #ddd;background:#fff;cursor:pointer}
    .danger{background:#ffecec;border-color:#ffb3b3}
    .green{background:#e6f6ff;border-color:#bfe4ff}
    pre{white-space:pre-wrap;word-break:break-word}
  </style>
</head>
<body class="page">
  <main class="container">
    <div class="card">
      <div class="admin-header">
        <div>
          <h2>Admin Panel — LOAN PAY</h2>
          <div class="muted">View & export submitted applications</div>
        </div>
        <div>
          <input id="adminPass" placeholder="Admin password" style="padding:8px;border-radius:8px;border:1px solid #ddd" />
          <button id="unlockBtn" class="small-btn">Unlock</button>
        </div>
      </div>

      <div id="adminArea" class="hidden">
        <div style="display:flex;gap:10px;align-items:center;margin-bottom:10px">
          <button id="refreshBtn" class="small-btn green">Refresh</button>
          <button id="exportBtn" class="small-btn">Export CSV</button>
          <button id="clearBtn" class="small-btn danger">Clear Local Data</button>
          <div class="muted" style="margin-left:auto">Total: <span id="totalCount">0</span></div>
        </div>

        <div id="tableWrap"></div>

        <h4 style="margin-top:14px">Raw JSON (localStorage)</h4>
        <pre id="rawJson" style="max-height:220px;overflow:auto;background:#fafafa;padding:12px;border-radius:8px"></pre>
      </div>

      <div id="lockedNote">
        <p class="muted">Enter admin password to view submissions.</p>
      </div>
    </div>
  </main>

<script>
  // ====== CONFIG: change this password to something secure BEFORE publishing ======
  const ADMIN_PASSWORD = "loanadmin123"; // change this
  // ==============================================================================

  const unlockBtn = document.getElementById('unlockBtn');
  const adminPass = document.getElementById('adminPass');
  const adminArea = document.getElementById('adminArea');
  const lockedNote = document.getElementById('lockedNote');
  const tableWrap = document.getElementById('tableWrap');
  const rawJson = document.getElementById('rawJson');
  const totalCount = document.getElementById('totalCount');

  function readApps() {
    try {
      const apps = JSON.parse(localStorage.getItem('loanpay_apps') || '[]');
      return Array.isArray(apps) ? apps : [];
    } catch(e){ return []; }
  }

  function renderTable() {
    const apps = readApps();
    totalCount.innerText = apps.length;
    if (apps.length === 0) {
      tableWrap.innerHTML = '<div class="muted">Koi application nahi mili (localStorage empty).</div>';
      rawJson.innerText = JSON.stringify(apps, null, 2);
      return;
    }
    let html = '<table class="table"><thead><tr><th>#</th><th>Name</th><th>Email</th><th>Phone</th><th>Amount</th><th>Tenure</th><th>Interest</th><th>Purpose</th><th>Date</th></tr></thead><tbody>';
    apps.forEach((a,i) => {
      html += `<tr>
        <td>${i+1}</td>
        <td>${escapeHtml(a.name||'')}</td>
        <td>${escapeHtml(a.email||'')}</td>
        <td>${escapeHtml(a.phone||'')}</td>
        <td>₹ ${a.amount||0}</td>
        <td>${a.tenure||''}</td>
        <td>${a.interest||''}%</td>
        <td>${escapeHtml(a.purpose||'')}</td>
        <td>${escapeHtml(a.date||'')}</td>
      </tr>`;
    });
    html += '</tbody></table>';
    tableWrap.innerHTML = html;
    rawJson.innerText = JSON.stringify(readApps(), null, 2);
  }

  function escapeHtml(s){ return String(s||'').replace(/[&<>"']/g, m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }

  function exportCSV() {
    const apps = readApps();
    if (!apps.length) { alert('No applications to export'); return; }
    const header = ['Name','Email','Phone','Amount','Tenure','Interest','Purpose','Date'];
    const rows = apps.map(a => [a.name||'', a.email||'', a.phone||'', a.amount||'', a.tenure||'', a.interest||'', a.purpose||'', a.date||'']);
    const csv = [header, ...rows].map(r => r.map(cell => `"${String(cell).replace(/"/g,'""')}"`).join(',')).join('\n');
    const blob = new Blob([csv], {type: 'text/csv;charset=utf-8;'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a'); a.href = url; a.download = 'loanpay_applications.csv'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
  }

  function clearLocal() {
    if (!confirm('Are you sure? This will remove local submissions.')) return;
    localStorage.removeItem('loanpay_apps');
    renderTable();
    alert('Local data cleared');
  }

  unlockBtn.onclick = () => {
    if (adminPass.value === ADMIN_PASSWORD) {
      adminArea.classList.remove('hidden');
      lockedNote.classList.add('hidden');
      renderTable();
    } else {
      alert('Wrong password');
    }
  };

  document.getElementById('refreshBtn').onclick = renderTable;
  document.getElementById('exportBtn').onclick = exportCSV;
  document.getElementById('clearBtn').onclick = clearLocal;

  // auto unlock if you previously unlocked during this session
  if (sessionStorage.getItem('loanpay_admin')) {
    adminArea.classList.remove('hidden');
    lockedNote.classList.add('hidden');
    renderTable();
  }
</script>
</body>
</html>
